{% extends "ucm/basen.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
{% load ucm_extras %}
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script id="MathJax-script" type="text/javascript" async src="/static/mathjax/tex-chtml.js"></script>


<!-- Main Content -->
<div class="pt-3 pb-3">
  <div class="container"> <!-- CONTAINER-1 -->
      <!-- Main content -->
      <div class="row mt-0 mt-md-4">
          <div class="col-lg-3 col-md-4 col-12">
              <!-- Side navabar -->
              <nav class="navbar navbar-expand-md navbar-light shadow-sm mb-4 mb-lg-0 sidenav">
                  <!-- Menu -->
                  <a class="d-xl-none d-lg-none d-md-none text-inherit font-weight-bold" href="#!">Menu</a>
                  <!-- Button -->
                  <button class="navbar-toggler d-md-none icon-shape icon-sm rounded bg-primary text-light" type="button"
                      data-toggle="collapse" data-target="#sidenav" aria-controls="sidenav" aria-expanded="false"
                      aria-label="Toggle navigation">
                      <span class="fe fe-menu"></span>
                  </button>
                  <!-- Navbar Collapse -->
                  <div class="collapse navbar-collapse" id="sidenav">
                      <div class="navbar-nav flex-column">
                          <!-- Navbar header -->
                          <span class="navbar-header">Dashboard</span>
                          <ul class="list-unstyled ml-n2 mb-4">
                              <!-- Nav item -->
                              <li class="nav-item">
                                  <a class="nav-link" href="dashboard-instructor.html"><i class="fe fe-home nav-icon"></i>My
                                      Dashboard</a>
                              </li>
                              <!-- Nav item -->
                              <li class="nav-item {% iif context.ptitle 'Member Topics' 'active' %}">
                                  <a class="nav-link" href="{% url 'ucm:member_topic'%}"><i class="fe fe-settings nav-icon"></i>My Topics</a>                                    
                              </li>
                              <!-- Nav item -->
                              <li class="nav-item">
                                  <a class="nav-link" href="instructor-reviews.html"><i class="fe fe-star nav-icon"></i>Reviews</a>
                              </li>
                              <!-- Nav item -->
                              <li class="nav-item">
                                  <a class="nav-link" href="instructor-earning.html"><i
                                          class="fe fe-pie-chart nav-icon"></i>Earnings</a>
                              </li>
                              <!-- Nav item -->
                              <li class="nav-item">
                                  <a class="nav-link" href="instructor-order.html"><i
                                          class="fe fe-shopping-bag nav-icon"></i>Orders</a>
                              </li>
                              <!-- Nav item -->
                              <li class="nav-item">
                                  <a class="nav-link" href="instructor-students.html"><i class="fe fe-user nav-icon"></i>Students</a>
                              </li>
                              <!-- Nav item -->
                              <li class="nav-item">
                                  <a class="nav-link" href="instructor-payouts.html"><i
                                          class="fe fe-dollar-sign nav-icon"></i>Payouts</a>
                              </li>
                          </ul>
                      </div>
                  </div>
              </nav>
          </div> <!-- End of left side navigation menu-->

          <div class="col-lg-9 col-md-8 col-12"> <!-- Container for Main content-->
            <!-- Card -->
            <div class="card mb-4">
                <!-- Card header -->
                <div class="card-header">
                    <h3 class="mb-0">Topics</h3>
                    <span>Manage your topics and its update like live, draft and
                        insight.
                    </span>
                </div>
                <!-- Card body -->
                <div class="card-body">



                        <div class="col-md-12">
                          {% for val in note %}
                          {% if val.ntype == "title" %}
                            <h1 class="display-6">
                              {{val.ndata}}
                            </h1>
                          {% elif val.ntype == "text" %}
                            <p class="text-break fs-1">{{ val.ndata }}
                              {% if val.audio %}        
                              <input 
                                onclick="audioPlay('{{request.scheme}}://{{request.META.HTTP_HOST}}{% static val.audio %}');"
                                type='button' value='ðŸ”Š Play' />
                              {% endif %}          
                            </p>
                          {% elif val.ntype == "html" %}
                          <p class="text-break fs-1">
                            {{ val.ndata| safe }}
                          </p>
                          {% elif val.ntype == "example" %}
                            <p class="text-break fs-1">{{ val.ndata }}
                              {% if val.audio %}
                                <input onclick="audioPlay('{{request.scheme}}://{{request.META.HTTP_HOST}}{% static val.audio %}');" type='button' value='ðŸ”Š Play' />
                              {% endif %}
                            </p>
                          {% elif val.ntype == "image" %}
                            <img src="{% static val.ndata %}" width="300" height="300" 
                              class="d-inline-block align-top rounded mx-auto" alt="ToDoApp" loading="lazy"/>
                            <br><br>
                          {% elif val.ntype == "url" %}
                            <a href="{{ val.ndata }}" target="_new">{{val.ndata}}</a><br>
                          {% else %}
                          {% endif %}
                          {% if forloop.first %}
                            {% if val.audio %}
                              <input class="btn btn-success" 
                                onclick="audioPlay('{{request.scheme}}://{{request.META.HTTP_HOST}}{% static val.audio %}');" 
                                type='button' value='ðŸ”Š Play' />
                            {% endif %}
                            <button type="button" class="btn btn-primary" name="flip_card" 
                              onclick="window.divCollapse(this,'#myCollapsible');">Show Contents</button>
                      <!--
                            { % else % }
                              <h1 class="display-6">Title not available</h1>
                            { % endif % }
                      -->
                      <!--  Progress bar commented
                            <div class="progress">
                              <div class="progress-bar progress-bar-striped progress-bar-animated" style="min-width: 20px;"></div>
                            </div>
                      -->
                            <hr class="my-4">
                        <div id="myCollapsible" class="collapse">
                          {% endif %}
                      
                          {% if forloop.last %}
                            <br>
                            <form name="form1" method="post" action="{% url 'ucm:topic_review' 0 %}">
                              {% csrf_token %} 
                              <input type="hidden" value="{{ topic }}" name="ritem"/>                              
                              <input type="hidden" value="{{userNote.id}}" name="usernoteid"/>
                              <button type="submit" class="btn btn-primary" name="r_0">Repeat</button>
                              <button type="submit" class="btn btn-primary" name="r_1">Good</button>
                              <button type="submit" class="btn btn-primary" name="r_2">Easy</button>
                            </form>
                      
                      <br> 
                      
                      <div class="col-12" style="background-color: #e9ecef;">

                        {% for rl in reviewLog.all %}
                        {% if forloop.first %}
                          <P>{{ reviewLog.count|expluralize:'Review Log' }}</P>
                        {% endif %}
                          <b>{{ rl.added_user }}</b> on {{ rl.cdate }}<br>
                          <P>{{ rl.notes }}</P>
                        {% empty %}
                          <P>No notes for this card</P>
                        {% endfor %}
                        {% crispy formReviewLog %}
                        <div id='form-errors'>{{ formNote.errors }}</div>  
                      </div>
                      
                          {% endif %}
                      
                        {% empty %}
                          {% if flag == "learn_more" %}
                            <p class="text-break fs-1">
                              You have completed your normal learning target for today [{{ topic }}].
                            </p>
                            <p class="text-break fs-1">Would you like to continue learning more now?</p>
                            <form name="form1" method="post" action="{% url 'ucm:more' %}">
                              {% csrf_token %} 
                              <input type="hidden" value="{{ topic }}" name="ritem"/>
                              <button type="submit" class="btn btn-primary" name="learn_more" value='Yes'>Yes</button>
                              <a class="btn btn-outline-primary" href="{% url 'ucm:home' %}">No</a>
                            </form>      
                          {% endif %}
                      
                          {% if flag == "no_more" %}
                            <p class="text-break fs-1">Your topic has no more cards left to learn. Either all the notes
                                of this topic is matured or none eligible for study [{{ topic }}].</p>
                            <a class="btn btn-primary" href="{% url 'ucm:home' %}">Ok</a>
                          {% endif %}
                          {% if flag == "not_subscribed" %}
                            <p class="text-break fs-1">The topic selected is not in your subscription list.  Subscribed first before learning [{{ topic }}].</p>
                            <a class="btn btn-primary" href="{% url 'ucm:home' %}">Ok</a>
                          {% endif %}
                        {% endfor %}
                        </div>
                        </div>
           












                </div>
            </div>
          </div> <!-- End of Main Content container-->
        </div> <!-- End of Main Content-->


  </div> <!-- End of CONTAINER-1 -->
</div> <!-- End of PY6-->















  <script>
    function divCollapse(btn, nname) {
      if ($(btn).text () == "Hide Contents") {
        $(btn).text("Show Contents");
      } else {
        $(btn).text("Hide Contents");
      }
      $(nname).collapse('toggle')
    }
  </script>
  
  <script>
    var audio = null;
  
    function audioInit (url) {
      audio = new Audio(url);  
    }
  
    function audioPlay (url) {
      audioInit (url);
      audio.play();
    }
  
    function AudioPause () {
        audio.pause();
    }
  
    function AudioCancel () {
        audio.pause();
        audio.currentTime = 0;
        audio = null;
    }
  
  </script>  
  {% endblock %}